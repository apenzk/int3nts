---
description: Intent Framework project architecture, patterns, and coding standards
alwaysApply: true
---

# Intent Framework Project Rules

For guidance on how to write rules, see [Cursor Rules Documentation](https://cursor.com/docs/context/rules).

## Commit Message Conventions

After completing a subtask or task, create a commit with the changes.

**If tests were run:**

```bash
git commit -m "<type of change>: <description>

- <more detailed points if needed (optional)>
- <more detailed points if needed (optional)>

Tests pass: Coordinator <number>, Trusted-GMP <number>, Solver <number>, MVM <amount>, EVM <amount>, SVM <number>, Frontend <number>"
```

**If tests were NOT run (e.g., project setup, docs only, no test-affecting changes):**

```bash
git commit -m "<type of change>: <description>

- <more detailed points if needed (optional)>
- <more detailed points if needed (optional)>"
```

**Commit Rules:**

- **ALWAYS commit after completing each subtask or task** - ensures incremental progress is saved
- **CRITICAL: NEVER run `git add` or `git add -A`** - files must already be staged by the user
- **Run tests before committing** ONLY if changes affect existing test code (e.g., adding new tests, modifying code that has tests)
- **Do NOT run tests for:** project setup, documentation-only changes, configuration files, or other non-code changes
- **If sandbox prevents test execution**, ask user for help or skip tests (don't include "Tests pass:" line)
- **Only include test results** in commit message if tests were actually run, in the format: `Tests pass: Coordinator <number>, Trusted-GMP <number>, Solver <number>, MVM <amount>, EVM <amount>, SVM <number>, Frontend <number>`
- **If tests were NOT run**, omit the "Tests pass:" line entirely from the commit message
- **Display test summary table** after running tests using the commands in the next subsection, showing passed/total for each category (Coordinator, Trusted-GMP, Solver, MVM, EVM, SVM, Frontend)
- Follow conventional commit format (e.g., `feat:`, `fix:`, `refactor:`, `test:`, `docs:`, `chore:`)
- Keep commit messages brief and professional
- Do NOT mention subtask or task IDs in commit messages
- Do NOT advertise AI tools in commits - no AI/Claude/LLM references, "Co-Authored-By" phrases, or similar

### Test Count Commands

Get test counts for all components and display in a summary table:

```bash
./testing-infra/run-all-unit-tests.sh
```

This script runs all tests and displays a summary table with passed/failed counts for each component.

Individual component commands:

```bash
# Coordinator tests
RUST_LOG=off nix develop ./nix -c bash -c "cd coordinator && cargo test --quiet" 2>&1 | grep -oE "[0-9]+ passed" | awk '{sum += $1} END {print sum}'

# Trusted-GMP tests
RUST_LOG=off nix develop ./nix -c bash -c "cd trusted-gmp && cargo test --quiet" 2>&1 | grep -oE "[0-9]+ passed" | awk '{sum += $1} END {print sum}'

# Move tests
nix develop ./nix -c bash -c "cd intent-frameworks/mvm && movement move test --dev --named-addresses mvmt_intent=0x123" 2>&1 | grep "Total tests:"

# Solver tests
RUST_LOG=off nix develop ./nix -c bash -c "cd solver && cargo test --quiet" 2>&1 | grep -oE "[0-9]+ passed" | awk '{sum += $1} END {print sum}'

# EVM tests
nix develop ./nix -c bash -c "cd intent-frameworks/evm && npm install && npm test" 2>&1 | grep -oE "[0-9]+ passing" | awk '{print $1}'

# Frontend tests
nix develop ./nix -c bash -c "cd frontend && npm install --legacy-peer-deps && npm test" 2>&1 | grep -oE "Tests[[:space:]]+[0-9]+ passed" | grep -oE "[0-9]+"

# SVM tests
nix develop ./nix -c bash -c "cd intent-frameworks/svm && ./scripts/test.sh" 2>&1 | grep -oE "[0-9]+ test" | awk '{print $1}'
```

## Context Requirements

**IMPORTANT:** The root [README.md](README.md) must always be included in context when working on this project. It provides essential project overview, quick start instructions, and links to all major components.

## Documentation

For information on how documentation is organized and how to navigate it, see [docs/docs-guide.md](docs/docs-guide.md).

### Markdown Style Guidelines

**IMPORTANT:** All markdown files must follow these formatting rules:

- **Blank lines around headings**: There must be a blank line before and after all headings (MD022)
- **Blank lines around lists**: There must be a blank line before bullet lists and numbered lists (MD032)
- **No multiple blank lines**: Use only one blank line between sections (MD012)

These rules ensure consistent formatting and prevent linting errors. Always check linting errors before committing documentation changes.

--------------------------------------------------------------------------------

## Project Overview

This is a cross-chain intent framework enabling conditional asset transfers across blockchain networks. The system supports both **inflow** (tokens locked on connected chain, desired on hub) and **outflow** (tokens locked on hub, desired on connected chain) flows.

For comprehensive architecture documentation, see `.taskmaster/docs/` - includes component-to-domain mapping, domain boundaries, data models, and use cases.

--------------------------------------------------------------------------------

## Code Organization

### Move/Aptos Contracts

See [Move Intent Framework Documentation](docs/intent-frameworks/mvm/README.md) for API reference, technical overview, and oracle-guarded intents. Planned cross-chain functions documented in [Implementation Plan](.taskmaster/implementplan.md).

### EVM/Solidity Contracts

See [EVM Intent Framework README](docs/intent-frameworks/evm/README.md) for contract interface and usage. Outflow transaction format documented in [Implementation Plan](.taskmaster/implementplan.md#scenario-b-evm-connected-chain).

### SVM/Solana Program

See [SVM Intent Framework README](docs/intent-frameworks/svm/README.md) for Solana escrow program structure and usage.

### Rust Services

See [Coordinator](docs/coordinator/README.md), [Trusted-GMP](docs/trusted-gmp/README.md), and [Solver](docs/solver/README.md) for service architecture and implementation details.

### Testing Infrastructure

See [Testing Infrastructure README](docs/testing-infra/README.md) for E2E test structure and utilities.

--------------------------------------------------------------------------------

## Coding Standards

See [`.cursor/codestandards.md`](.cursor/codestandards.md) for language-specific coding standards and conventions.

--------------------------------------------------------------------------------

## Documentation Standards

- **Location**: `docs/` directory
- **Structure**: Each major component has its own README.md
- **API docs**: Use code comments that can be extracted to API reference
- **Architecture docs**: Use mermaid diagrams for visual representation

## Testing Standards

- **Move tests**: Place in `intent-frameworks/mvm/tests/` with `*_tests.move` naming
- **Solidity tests**: Place in `intent-frameworks/evm/test/` with `*.test.js` naming
- **E2E tests**: Use shell scripts in `testing-infra/ci-e2e/e2e-tests-*/`
- **Test isolation**: Each test should be independent and clean up after itself
- **Balance checks**: Use granular balance display functions appropriate for the chain being tested

--------------------------------------------------------------------------------

## Common Patterns

### Error Handling

- Move: Use `abort` with error codes defined in module
- Solidity: Use `require()` with descriptive error messages
- Rust: Use `anyhow::Result` and propagate errors with context
- Shell scripts: Use `set -e` and check return codes
