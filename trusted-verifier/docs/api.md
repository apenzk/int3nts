# Trusted Verifier API

Base URL: `http://<host>:<port>` (defaults to `127.0.0.1:3000`)

All responses share the shape:

```
{
  "success": true|false,
  "message": string,
  "data": <payload|null>
}
```

## GET /health

Health check.

Example
```
curl -s http://127.0.0.1:3000/health
```

## GET /public-key

Returns the verifier public key (base64, 32 bytes).

Response
```
{
  "success": true,
  "data": {
    "public_key": "<base64>"
  }
}
```

## GET /events

Returns cached events observed by the monitor (intent, escrow, fulfillment) and cached approvals.

Response (abbreviated)
```
{
  "success": true,
  "data": {
    "intent_events": [
      {
        "chain": "hub",
        "intent_id": "0x...",
        "issuer": "0x...",
        "source_metadata": {"inner":"0xa"},
        "source_amount": 0,
        "desired_metadata": {"inner":"0xa"},
        "desired_amount": 100000000,
        "expiry_time": 1761765097,
        "revocable": false,
        "timestamp": 1761761513
      }
    ],
    "escrow_events": [ { ... } ],
    "fulfillment_events": [ { ... } ],
    "approvals": [ { ... } ]
  }
}
```

## GET /approvals

Returns approvals generated by the verifier after observing fulfillment + matching escrow.

Approval item
```
{
  "escrow_id": "0x...",
  "intent_id": "0x...",
  "approval_value": 1,
  "signature": "<base64>",
  "timestamp": 1761761504
}
```

Example
```
curl -s http://127.0.0.1:3000/approvals | jq
```

## POST /approval

Manually create an approval signature for a given `approval_value`.

Request
```
{
  "approval_value": 1
}
```

Response
```
{
  "success": true,
  "data": {
    "approval_value": 1,
    "signature": "<base64>",
    "timestamp": 1761761504
  }
}
```

## Usage in Escrow Release

1) Poll `/approvals` until an approval with your `escrow_id` appears
2) Submit connected‑chain entry: `complete_escrow_from_apt(escrow_id, approval_value, signature)`

In the integration script this is automated (bob‑chain2 profile):
```
aptos move run --profile bob-chain2 --assume-yes \
  --function-id "0x<connected_module_address>::intent_as_escrow_apt::complete_escrow_from_apt" \
  --args "address:<escrow_id>" "u64:<approval_value>" "hex:<signature_hex>"
```

Notes
- The signature is over BCS(u64 approval_value)
- Signature and keys are base64 in the API; convert as needed for on‑chain hex formats

